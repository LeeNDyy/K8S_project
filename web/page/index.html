<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤ –†–æ—Å—Å–∏–∏</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
</head>
<body>
    <section class="section">
        <div class="container">
            <div class="header-box">
                <h1 class="title has-text-centered">üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤ –†–æ—Å—Å–∏–∏</h1>
                <p class="subtitle has-text-centered">–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –†–ö–ù, DDoS –∞—Ç–∞–∫ –∏ —Å–±–æ–µ–≤</p>
            </div>

            <div class="stats-level level">
                <div class="level-item has-text-centered">
                    <div>
                        <p class="heading">–í—Å–µ–≥–æ —Å–µ—Ä–≤–∏—Å–æ–≤</p>
                        <p class="title">{{ .Stats.TotalServices }}</p>
                    </div>
                </div>
                <div class="level-item has-text-centered">
                    <div>
                        <p class="heading">–°–±–æ–∏</p>
                        <p class="title has-text-danger" id="down-count">{{ .Stats.DownServices }}</p>
                    </div>
                </div>
                <div class="level-item has-text-centered">
                    <div>
                        <p class="heading">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏</p>
                        <p class="title has-text-warning" id="blocked-count">{{ .Stats.BlockedServices }}</p>
                    </div>
                </div>
                <div class="level-item has-text-centered">
                    <div>
                        <p class="heading">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</p>
                        <p class="title is-6">{{ .LastChecked }}</p>
                    </div>
                </div>
            </div>

            <div class="controls buttons is-centered">
                <button class="button is-primary is-medium" 
                        hx-get="/status" 
                        hx-trigger="click"
                        hx-target="#status-container"
                        hx-indicator="#spinner">
                    üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å
                </button>
                <button class="button is-info is-medium"
                        hx-get="/status"
                        hx-trigger="every 30s"
                        hx-target="#status-container"
                        hx-indicator="#spinner">
                    ‚è∞ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                </button>
            </div>

            <div id="spinner" class="htmx-indicator has-text-centered">
                <progress class="progress is-small is-primary" max="100">–ó–∞–≥—Ä—É–∑–∫–∞...</progress>
            </div>

            <div id="status-container" class="columns is-multiline mt-4">
                {{ template "status_partial" . }}
            </div>

            <footer class="footer">
                <div class="content has-text-centered">
                    <p>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{ .LastChecked }}</p>
                    <p class="is-size-7">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</p>
                </div>
            </footer>
        </div>
    </section>

    <script>
        function updateStats() {
            const down = document.querySelectorAll('.status-down, .status-blocked').length;
            const blocked = document.querySelectorAll('.status-blocked').length;
            document.getElementById('down-count').textContent = down;
            document.getElementById('blocked-count').textContent = blocked;
        }

        document.addEventListener('DOMContentLoaded', updateStats);
        document.body.addEventListener('htmx:afterSwap', updateStats);
        
        setInterval(updateStats, 5000);
    </script>
</body>
</html>